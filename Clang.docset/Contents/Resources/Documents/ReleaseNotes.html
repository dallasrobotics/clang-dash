<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Clang 4.0.0 Release Notes &mdash; Clang 4 documentation</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Clang 4 documentation" href="index.html" />
    <link rel="next" title="Clang Compiler User’s Manual" href="UsersManual.html" />
    <link rel="prev" title="Using Clang as a Compiler" href="index.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>Clang 4 documentation</span></a></h1>
        <h2 class="heading"><span>Clang 4.0.0 Release Notes</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="index.html">Using Clang as a Compiler</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="UsersManual.html">Clang Compiler User&#8217;s Manual</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="clang-4-0-0-release-notes">
<h1>Clang 4.0.0 Release Notes<a class="headerlink" href="#clang-4-0-0-release-notes" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#what-s-new-in-clang-4-0-0" id="id2">What&#8217;s New in Clang 4.0.0?</a><ul>
<li><a class="reference internal" href="#major-new-features" id="id3">Major New Features</a></li>
<li><a class="reference internal" href="#improvements-to-thinlto-flto-thin" id="id4">Improvements to ThinLTO (-flto=thin)</a></li>
<li><a class="reference internal" href="#new-compiler-flags" id="id5">New Compiler Flags</a></li>
<li><a class="reference internal" href="#opencl-c-language-changes-in-clang" id="id6">OpenCL C Language Changes in Clang</a></li>
<li><a class="reference internal" href="#static-analyzer" id="id7">Static Analyzer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#additional-information" id="id8">Additional Information</a></li>
</ul>
</div>
<p>Written by the <a class="reference external" href="http://llvm.org/">LLVM Team</a></p>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This document contains the release notes for the Clang C/C++/Objective-C/OpenCL
frontend, part of the LLVM Compiler Infrastructure, release 4.0.0. Here we
describe the status of Clang in some detail, including major
improvements from the previous release and new feature work. For the
general LLVM release notes, see <a class="reference external" href="http://llvm.org/docs/ReleaseNotes.html">the LLVM
documentation</a>. All LLVM
releases may be downloaded from the <a class="reference external" href="http://llvm.org/releases/">LLVM releases web
site</a>.</p>
<p>For more information about Clang or LLVM, including information about
the latest release, please check out the main please see the <a class="reference external" href="http://clang.llvm.org">Clang Web
Site</a> or the <a class="reference external" href="http://llvm.org">LLVM Web
Site</a>.</p>
</div>
<div class="section" id="what-s-new-in-clang-4-0-0">
<h2><a class="toc-backref" href="#id2">What&#8217;s New in Clang 4.0.0?</a><a class="headerlink" href="#what-s-new-in-clang-4-0-0" title="Permalink to this headline">¶</a></h2>
<p>Some of the major new features and improvements to Clang are listed
here. Generic improvements to Clang as a whole or to its underlying
infrastructure are described first, followed by language-specific
sections with improvements to Clang&#8217;s support for those languages.</p>
<div class="section" id="major-new-features">
<h3><a class="toc-backref" href="#id3">Major New Features</a><a class="headerlink" href="#major-new-features" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">The <a class="reference external" href="AttributeReference.html#diagnose-if">diagnose_if</a> attribute has been
added to clang. This attribute allows
clang to emit a warning or error if a function call meets one or more
user-specified conditions.</p>
</li>
<li><p class="first">Enhanced devirtualization with
<a class="reference external" href="UsersManual.html#cmdoption-fstrict-vtable-pointers">-fstrict-vtable-pointers</a>.
Clang devirtualizes across different basic blocks, like loops:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">struct</span> <span class="n">A</span> <span class="p">{</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">foo</span><span class="p">();</span>
<span class="p">};</span>
<span class="kt">void</span> <span class="nf">indirect</span><span class="p">(</span><span class="n">A</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">a</span><span class="p">.</span><span class="n">foo</span><span class="p">();</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">test</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">A</span> <span class="n">a</span><span class="p">;</span>
    <span class="n">indirect</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="improvements-to-thinlto-flto-thin">
<h3><a class="toc-backref" href="#id4">Improvements to ThinLTO (-flto=thin)</a><a class="headerlink" href="#improvements-to-thinlto-flto-thin" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Integration with profile data (PGO). When available, profile data enables
more accurate function importing decisions, as well as cross-module indirect
call promotion.</li>
<li>Significant build-time and binary-size improvements when compiling with debug
info (<code class="docutils literal"><span class="pre">-g</span></code>).</li>
</ul>
</div>
<div class="section" id="new-compiler-flags">
<h3><a class="toc-backref" href="#id5">New Compiler Flags</a><a class="headerlink" href="#new-compiler-flags" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The option <code class="docutils literal"><span class="pre">-Og</span></code> has been added to optimize the debugging experience.
For now, this option is exactly the same as <code class="docutils literal"><span class="pre">-O1</span></code>. However, in the future,
some other optimizations might be enabled or disabled.</li>
<li>The option <code class="docutils literal"><span class="pre">-MJ</span></code> has been added to simplify adding JSON compilation
database output into existing build systems.</li>
</ul>
</div>
<div class="section" id="opencl-c-language-changes-in-clang">
<h3><a class="toc-backref" href="#id6">OpenCL C Language Changes in Clang</a><a class="headerlink" href="#opencl-c-language-changes-in-clang" title="Permalink to this headline">¶</a></h3>
<p><strong>The following bugs in the OpenCL header have been fixed:</strong></p>
<ul class="simple">
<li>Added missing <code class="docutils literal"><span class="pre">overloadable</span></code> and <code class="docutils literal"><span class="pre">convergent</span></code> attributes.</li>
<li>Removed some erroneous extra <code class="docutils literal"><span class="pre">native_*</span></code> functions.</li>
</ul>
<p><strong>The following bugs in the generation of metadata have been fixed:</strong></p>
<ul class="simple">
<li>Corrected the SPIR version depending on the OpenCL version.</li>
<li>Source level address spaces are taken from the SPIR specification.</li>
<li>Image types now contain no access qualifier.</li>
</ul>
<p><strong>The following bugs in the AMD target have been fixed:</strong></p>
<ul class="simple">
<li>Corrected the bitwidth of <code class="docutils literal"><span class="pre">size_t</span></code> and NULL pointer value with respect to
address spaces.</li>
<li>Added <code class="docutils literal"><span class="pre">cl_khr_subgroups</span></code>, <code class="docutils literal"><span class="pre">cl_amd_media_ops</span></code> and <code class="docutils literal"><span class="pre">cl_amd_media_ops2</span></code>
extensions.</li>
<li>Added <code class="docutils literal"><span class="pre">cl-denorms-are-zero</span></code> support.</li>
<li>Changed address spaces for image objects to be <code class="docutils literal"><span class="pre">constant</span></code>.</li>
<li>Added little-endian.</li>
</ul>
<p><strong>The following bugs in OpenCL 2.0 have been fixed:</strong></p>
<ul class="simple">
<li>Fixed pipe builtin function return type, added extra argument to generated
IR intrinsics to propagate size and alignment information of the pipe packed
type.</li>
<li>Improved pipe type to accommodate access qualifiers.</li>
<li>Added correct address space to the ObjC block generation and <code class="docutils literal"><span class="pre">enqueue_kernel</span></code>
prototype.</li>
<li>Improved handling of integer parameters of <code class="docutils literal"><span class="pre">enqueue_kernel</span></code> prototype. We
now allow <code class="docutils literal"><span class="pre">size_t</span></code> instead of <code class="docutils literal"><span class="pre">int</span></code> for specifying block parameter sizes.</li>
<li>Allow using NULL (aka <code class="docutils literal"><span class="pre">CLK_NULL_QUEUE</span></code>) with <code class="docutils literal"><span class="pre">queue_t</span></code>.</li>
</ul>
<p><strong>Improved the following diagnostics:</strong></p>
<ul class="simple">
<li>Disallow address spaces other than <code class="docutils literal"><span class="pre">global</span></code> for kernel pointer parameters.</li>
<li>Correct the use of half type argument and pointer assignment with
dereferencing.</li>
<li>Disallow variadic arguments in functions and blocks.</li>
<li>Allow partial initializer for array and struct.</li>
</ul>
<p><strong>Some changes to OpenCL extensions have been made:</strong></p>
<ul>
<li><p class="first">Added <code class="docutils literal"><span class="pre">cl_khr_mipmap_image</span></code>.</p>
</li>
<li><p class="first">Added <code class="docutils literal"><span class="pre">-cl-ext</span></code> flag to allow overwriting supported extensions otherwise
set by the target compiled for (Example: <code class="docutils literal"><span class="pre">-cl-ext=-all,+cl_khr_fp16</span></code>).</p>
</li>
<li><p class="first">New types and functions can now be flexibly added to extensions using the
following pragmas instead of modifying the Clang source code:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#pragma OPENCL EXTENSION the_new_extension_name : begin</span>
<span class="c1">// declare types and functions associated with the extension here</span>
<span class="cp">#pragma OPENCL EXTENSION the_new_extension_name : end</span>
</pre></div>
</div>
</li>
</ul>
<p><strong>Miscellaneous changes:</strong></p>
<ul class="simple">
<li>Fix <code class="docutils literal"><span class="pre">__builtin_astype</span></code> to cast between different address space objects.</li>
<li>Allow using <code class="docutils literal"><span class="pre">opencl_unroll_hint</span></code> with earlier OpenCL versions than 2.0.</li>
<li>Improved handling of floating point literal to default to single precision if
fp64 extension is not enabled.</li>
<li>Refactor <code class="docutils literal"><span class="pre">sampler_t</span></code> implementation to simplify initializer representation
which is now handled as a compiler builtin function with an integer value
passed into it.</li>
<li>Change fake address space map to use the SPIR convention.</li>
<li>Added <a class="reference external" href="UsersManual.html#opencl-features">the OpenCL manual</a> to Clang
documentation.</li>
</ul>
</div>
<div class="section" id="static-analyzer">
<h3><a class="toc-backref" href="#id7">Static Analyzer</a><a class="headerlink" href="#static-analyzer" title="Permalink to this headline">¶</a></h3>
<p>With the option <code class="docutils literal"><span class="pre">--show-description</span></code>, scan-build&#8217;s list of defects will also
show the description of the defects.</p>
<p>The analyzer now provides better support of code that uses gtest.</p>
<p>Several new checks were added:</p>
<ul class="simple">
<li>The analyzer warns when virtual calls are made from constructors or
destructors. This check is off by default but can be enabled by passing the
following command to scan-build: <code class="docutils literal"><span class="pre">-enable-checker</span> <span class="pre">optin.cplusplus.VirtualCall</span></code>.</li>
<li>The analyzer checks for synthesized copy properties of mutable types in
Objective C, such as <code class="docutils literal"><span class="pre">NSMutableArray</span></code>. Calling the setter for these properties
will store an immutable copy of the value.</li>
<li>The analyzer checks for calls to <code class="docutils literal"><span class="pre">dispatch_once()</span></code> that use an Objective-C
instance variable as the predicate. Using an instance variable as a predicate
may result in the passed-in block being executed multiple times or not at all.
These calls should be rewritten either to use a lock or to store the predicate
in a global or static variable.</li>
<li>The analyzer checks for unintended comparisons of <code class="docutils literal"><span class="pre">NSNumber</span></code>, <code class="docutils literal"><span class="pre">CFNumberRef</span></code>, and
other Cocoa number objects to scalar values.</li>
</ul>
</div>
</div>
<div class="section" id="additional-information">
<h2><a class="toc-backref" href="#id8">Additional Information</a><a class="headerlink" href="#additional-information" title="Permalink to this headline">¶</a></h2>
<p>A wide variety of additional information is available on the <a class="reference external" href="http://clang.llvm.org/">Clang web
page</a>. The web page contains versions of the
API documentation which are up-to-date with the Subversion version of
the source code. You can access versions of these documents specific to
this release by going into the &#8220;<code class="docutils literal"><span class="pre">clang/docs/</span></code>&#8221; directory in the Clang
tree.</p>
<p>If you have any questions or comments about Clang, please feel free to
contact us via the <a class="reference external" href="http://lists.llvm.org/mailman/listinfo/cfe-dev">mailing
list</a>.</p>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="index.html">Using Clang as a Compiler</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="UsersManual.html">Clang Compiler User&#8217;s Manual</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2007-2017, The Clang Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>